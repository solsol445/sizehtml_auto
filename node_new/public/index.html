<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Resizer - Web Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: #4facfe;
            background: #f0f8ff;
        }

        .upload-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        input[type="number"], input[type="file"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="number"]:focus, input[type="file"]:focus {
            outline: none;
            border-color: #4facfe;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-small {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }

        .progress {
            display: none;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s ease;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .gallery-section {
            margin-top: 40px;
        }

        .gallery-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .folders-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .folder-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }

        .folder-card:hover {
            transform: translateY(-5px);
        }

        .folder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .folder-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .folder-count {
            background: #4facfe;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .image-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .image-item:hover {
            transform: scale(1.05);
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #f8f9fa;
        }

        .no-images {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            padding: 20px;
        }

        .refresh-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.3s ease;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        /* External Folder Section */
        .external-folder-section {
            margin-bottom: 40px;
        }

        .external-folder-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .folder-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .folder-input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .folder-input-group input:focus {
            outline: none;
            border-color: #4facfe;
        }

        /* Preset Styles */
        .preset-container {
            position: relative;
            margin-bottom: 20px;
        }

        .preset-main-btn {
            background: linear-gradient(135deg, #6c757d, #495057);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .preset-main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .preset-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .preset-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .preset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }

        /* Gallery View Styles */
        .gallery-view {
            display: none;
        }

        .gallery-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 20px;
            transition: background 0.3s ease;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .gallery-title {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .gallery-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
        }

        .gallery-item img {
            width: 100%;
            height: 200px;
            object-fit: contain;
            background: #f8f9fa;
        }

        .gallery-item-info {
            padding: 15px;
        }

        .gallery-item-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
            word-break: break-all;
        }

        .gallery-item-size {
            font-size: 0.9em;
            color: #6c757d;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
        }

        .modal-content {
            position: relative;
            margin: auto;
            padding: 20px;
            width: 90vw;
            height: 90vh;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 10px;
        }

        .modal-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            font-size: 2rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-nav:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-50%) scale(1.1);
        }

        .modal-nav-left {
            left: 20px;
        }

        .modal-nav-right {
            right: 20px;
        }

        /* Delete Modal Styles */
        .delete-modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 320px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
            padding: 24px;
            text-align: center;
            z-index: 1001;
            border: 1px solid rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
        }

        .delete-modal-content h3 {
            margin: 0 0 12px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .delete-modal-content p {
            margin: 0 0 20px 0;
            color: #5a6c7d;
            font-size: 14px;
            line-height: 1.5;
            font-weight: 400;
        }

        .delete-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .btn-cancel {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            color: #6c757d;
            border: 2px solid #dee2e6;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 80px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-cancel:hover {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
            border-color: #adb5bd;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .btn-cancel:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .btn-danger {
            background: linear-gradient(145deg, #dc3545, #c82333);
            color: white;
            border: 2px solid #dc3545;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 80px;
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
        }

        .btn-danger:hover {
            background: linear-gradient(145deg, #c82333, #a71e2a);
            border-color: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4);
        }

        .btn-danger:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
        }

        /* Copy Modal Styles */
        .copy-modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
            padding: 24px;
            text-align: center;
            z-index: 1001;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .copy-modal-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .copy-form {
            text-align: left;
            margin-bottom: 20px;
        }

        .copy-form .form-group {
            margin-bottom: 15px;
        }

        .copy-form label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .copy-form input,
        .copy-form select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .copy-form input:focus,
        .copy-form select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }

        .preset-options {
            display: flex;
            gap: 20px;
            margin-top: 5px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .radio-option input[type="radio"] {
            margin-right: 8px;
            width: auto;
            padding: 0;
        }

        .radio-option span {
            user-select: none;
        }

        .copy-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: 2px solid #007bff;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 100px;
        }

        .btn-primary:hover {
            background: linear-gradient(145deg, #0056b3, #004085);
            border-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
        }

        .copy-btn {
            background: linear-gradient(145deg, #28a745, #1e7e34);
            color: white;
            border: 2px solid #28a745;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: linear-gradient(145deg, #1e7e34, #155724);
            border-color: #1e7e34;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .delete-copy-btn {
            background: linear-gradient(145deg, #dc3545, #c82333);
            color: white;
            border: 2px solid #dc3545;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .delete-copy-btn:hover {
            background: linear-gradient(145deg, #c82333, #bd2130);
            border-color: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
        }

        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #ffeeba;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }

        .btn-danger {
            background: linear-gradient(145deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.4);
        }

        .btn-danger:hover {
            background: linear-gradient(145deg, #c82333, #bd2130);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.6);
        }

        .pattern-settings-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .pattern-settings-btn:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .pattern-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .pattern-checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            background: #f8f9fa;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s ease;
            user-select: none;
        }

        .pattern-checkbox-item:hover {
            background: #e9ecef;
        }

        .pattern-checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            cursor: pointer;
        }

        .pattern-checkbox-item span {
            font-size: 14px;
            color: #495057;
            font-family: 'Courier New', monospace;
        }

        .pattern-checkbox-item.html-pattern.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f1f3f5;
        }

        .pattern-checkbox-item.html-pattern.disabled input[type="checkbox"] {
            cursor: not-allowed;
        }

        /* Progress Modal Styles */
        .progress-modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 500px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px;
            z-index: 1001;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .progress-modal-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .progress-info {
            text-align: center;
            margin-top: 10px;
        }

        .progress-status {
            font-size: 16px;
            color: #495057;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .progress-time {
            font-size: 14px;
            color: #6c757d;
        }

        .progress-details {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .progress-detail-item {
            text-align: center;
        }

        .progress-detail-label {
            font-size: 12px;
            color: #868e96;
            margin-bottom: 5px;
        }

        .progress-detail-value {
            font-size: 20px;
            font-weight: 700;
            color: #495057;
        }

        .progress-complete-icon {
            font-size: 60px;
            text-align: center;
            margin-bottom: 15px;
        }

        .progress-complete-message {
            text-align: center;
            font-size: 18px;
            color: #28a745;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .progress-error-list {
            max-height: 150px;
            overflow-y: auto;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
            font-size: 13px;
            color: #856404;
        }

        .progress-close-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(145deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .progress-close-btn:hover {
            background: linear-gradient(145deg, #0056b3, #004085);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        }

        /* Gallery Actions */
        .gallery-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nas-btn {
            background: linear-gradient(145deg, #17a2b8, #138496);
            color: white;
            border: 2px solid #17a2b8;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nas-btn:hover {
            background: linear-gradient(145deg, #138496, #117a8b);
            border-color: #138496;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(23, 162, 184, 0.3);
        }

        .sync-btn {
            background: linear-gradient(145deg, #6f42c1, #5a32a3);
            color: white;
            border: 2px solid #6f42c1;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .sync-btn:hover {
            background: linear-gradient(145deg, #5a32a3, #4e2a8e);
            border-color: #5a32a3;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(111, 66, 193, 0.3);
        }

        /* NAS Modal Styles */
        .nas-modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15), 0 4px 8px rgba(0,0,0,0.1);
            padding: 24px;
            text-align: center;
            z-index: 1001;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .nas-modal-content h3 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .nas-form {
            text-align: left;
            margin-bottom: 20px;
        }

        .nas-form .form-group {
            margin-bottom: 15px;
        }

        .nas-form label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        .nas-form input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .nas-form input:focus {
            outline: none;
            border-color: #17a2b8;
            box-shadow: 0 0 0 3px rgba(23, 162, 184, 0.1);
        }

        .nas-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        /* Delete buttons for folders and images */
        .delete-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: rgba(220, 53, 69, 1);
            transform: scale(1.1);
        }

        .folder-card {
            position: relative;
        }

        .gallery-item {
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            color: #666;
            font-size: 24px;
            font-weight: normal;
            cursor: pointer;
            z-index: 1001;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .modal-close:hover {
            color: #333;
            background: rgba(255, 255, 255, 1);
            border-color: #ddd;
            transform: scale(1.1);
        }

        .modal-close:active {
            transform: scale(0.95);
        }

        .modal-info {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-align: center;
            max-width: 80%;
            z-index: 1002;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .folders-grid {
                grid-template-columns: 1fr;
            }

            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .gallery-item img {
                height: 150px;
                object-fit: contain;
            }

            .modal-content {
                width: 95vw;
                height: 95vh;
                padding: 10px;
            }

            .modal-close {
                right: 15px;
                font-size: 35px;
            }

            .modal-info {
                font-size: 12px;
                padding: 8px 12px;
                max-width: 90%;
            }
            
            .modal-nav {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            
            .modal-nav-left {
                left: 10px;
            }
            
            .modal-nav-right {
                right: 10px;
            }
            
            .delete-modal-content {
                width: 280px;
                padding: 20px;
                margin: 20px;
            }
            
            .delete-modal-content h3 {
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            .delete-modal-content p {
                font-size: 13px;
                margin-bottom: 18px;
            }
            
            .delete-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn-cancel, .btn-danger {
                padding: 12px 20px;
                font-size: 13px;
            }
            
            .btn-cancel, .btn-danger {
                width: 100%;
                margin: 2px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñºÔ∏è Image Resizer</h1>
            <p>High-quality image resizing with minimal loss</p>
        </div>

        <div class="main-content">
            <!-- Preset Section -->
            <div class="preset-container">
                <button class="preset-main-btn" onclick="openPresetWindow()">
                    ‚öôÔ∏è Size Presets
                </button>
                <div class="preset-buttons" id="presetButtons">
                    <!-- Preset buttons will be loaded here -->
                </div>
            </div>

            <!-- Upload Section -->
            <div class="upload-section">
                <h2>üì§ Upload & Resize Images</h2>
                
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="width">Width (px)</label>
                            <input type="number" id="width" name="width" required min="1" placeholder="ex) 750">
                        </div>
                        <div class="form-group">
                            <label for="height">Height (px)</label>
                            <input type="number" id="height" name="height" required min="1" placeholder="ex) 1000">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="images">Select Images (JPG/JPEG)</label>
                        <input type="file" id="images" name="images" multiple accept="image/jpeg,image/jpg" required>
                    </div>
                    
                    <button type="submit" class="btn" id="submitBtn">
                        üì§ Process Images
                    </button>
                </form>

                <div class="progress" id="progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p id="progressText">Processing...</p>
                </div>

                <div class="result" id="result"></div>
            </div>

            <!-- External Folder Browser -->
            <div class="external-folder-section">
                <h2>üîó Browse External Folder</h2>
                <div class="folder-input-group">
                    <input type="text" id="externalPath" placeholder="Í≤ΩÎ°úÎ•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò Ìè¥ÎçîÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî">
                    <button class="btn" onclick="browseExternalFolder()" style="width: auto; padding: 10px 20px;">üìÇ Browse</button>
                    <button class="btn-small" onclick="selectLocalFolder()" style="width: auto; padding: 10px 15px; background: #6c757d;">üìÅ Select Folder</button>
                    <input type="file" id="folderSelector" webkitdirectory directory multiple style="display: none;" onchange="handleFolderSelect(event)">
                </div>
                <div class="folders-grid" id="externalFoldersGrid" style="display: none;">
                    <!-- External folders will be loaded here -->
                </div>
            </div>


            <!-- Gallery View -->
            <div class="gallery-view" id="galleryView">
                <div class="gallery-header">
                    <button class="back-btn" onclick="showFoldersView()">‚Üê Back to Folders</button>
                    <div class="gallery-title" id="galleryTitle">Gallery</div>
                    <div class="gallery-actions">
                        <button class="copy-btn" onclick="openCopyModal()">üìÅ 1px Copy</button>
                        <button class="delete-copy-btn" onclick="openDeleteCopyModal()">üóëÔ∏è ÎèôÍ∏∞Ìôî ÏÑúÎ≤Ñ ÏÇ≠Ï†ú</button>
                        <button class="nas-btn" onclick="openNasModal()">üì° NAS Ï†ÑÏÜ°</button>
                        <button class="sync-btn" onclick="openSyncModal()">üîÑ Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî</button>
                    </div>
                </div>
                <div class="gallery-grid" id="galleryGrid">
                    <!-- Gallery items will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <button class="modal-nav modal-nav-left" onclick="showPreviousImage()" title="Previous Image (‚Üê)">‚Äπ</button>
            <img id="modalImage" src="" alt="">
            <button class="modal-nav modal-nav-right" onclick="showNextImage()" title="Next Image (‚Üí)">‚Ä∫</button>
            <div class="modal-info" id="modalInfo"></div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="delete-modal-content">
            <h3>üóëÔ∏è ÏÇ≠Ï†ú ÌôïÏù∏</h3>
            <p id="deleteMessage">Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
            <div class="delete-buttons">
                <button class="btn-cancel" onclick="closeDeleteModal()">Ï∑®ÏÜå</button>
                <button class="btn-danger" onclick="confirmDelete()">ÏÇ≠Ï†ú</button>
            </div>
        </div>
    </div>

    <!-- 1px Copy Modal -->
    <div id="copyModal" class="modal">
        <div class="copy-modal-content" style="max-width: 450px;">
            <h3>üìÅ 1px Ïù¥ÎØ∏ÏßÄ Î≥µÏÇ¨</h3>
            <div class="copy-form">
                <div class="form-group">
                    <label for="copyPath">Í≤ΩÎ°ú</label>
                    <input type="text" id="copyPath" placeholder="Í≤ΩÎ°úÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="copySeason">ÏãúÏ¶å</label>
                    <input type="text" id="copySeason" placeholder="Ïòà: 25FW" maxlength="10">
                </div>
                <div class="form-group">
                    <label for="copyPreset">ÌîÑÎ¶¨ÏÖã ÏÑ†ÌÉù</label>
                    <select id="copyPreset">
                        <option value="">ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    </select>
                </div>
                
                <!-- ÏóëÏÖÄ ÌïÑÌÑ∞ÎßÅ ÏòµÏÖò -->
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="useExcelFilter" style="width: auto; margin-right: 8px;" onchange="toggleExcelFilterFields()">
                        <span>üìä ÏóëÏÖÄÎ°ú ÌïÑÌÑ∞ÎßÅÌïòÍ∏∞</span>
                    </label>
                </div>
                
                <div id="excelFilterFields" style="display: none;">
                    <div class="form-group">
                        <label for="copyExcelFile">
                            ÏóëÏÖÄ ÌååÏùº (.xlsx, .xls)
                            <button type="button" onclick="downloadSampleExcel()" style="margin-left: 10px; padding: 4px 10px; font-size: 12px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üì• ÏÉòÌîå
                            </button>
                        </label>
                        <input type="file" id="copyExcelFile" accept=".xlsx,.xls,.ods">
                    </div>
                    <div style="background: #fff3cd; padding: 10px; border-radius: 6px; border-left: 4px solid #ffc107; margin-top: 10px;">
                        <small style="color: #856404; font-size: 12px; line-height: 1.5;">
                            üìå ÏóëÏÖÄ "imgs" Ïó¥ Í∏∞Ï§Ä ‚Üí ÏãúÏ¶å-Îç∞Ïù¥ÌÑ∞_Ìå®ÌÑ¥ Í≤ÄÏÉâ<br>
                            Ïòà: SF177E-55NXFJ ‚Üí 25FW-SF177E-55N-XFJ_promotion_01.jpg
                        </small>
                    </div>
                </div>
                
                <div class="form-group">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                            <input type="checkbox" id="copyHtmlImages" style="width: auto; margin-right: 8px;" onchange="toggleHtmlPatterns()">
                            <span>HTML Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®</span>
                        </label>
                        <button type="button" class="pattern-settings-btn" onclick="openPatternSettings()" title="Ìå®ÌÑ¥ ÏÑ§Ï†ï">‚öôÔ∏è</button>
                    </div>
                </div>
                <div style="background: #f0f8ff; padding: 12px; border-radius: 6px; border-left: 4px solid #007bff; margin-top: 10px;">
                    <small style="color: #0056b3; font-size: 13px; line-height: 1.6;">
                        <strong>‚ÑπÔ∏è ÏûêÎèô Î≥µÏÇ¨:</strong> ÏãúÏ¶åÏóê Ìï¥ÎãπÌïòÎäî promotion, fit, illust Îì± 9Í∞ú Ìå®ÌÑ¥ Ïù¥ÎØ∏ÏßÄÎ•º Ï∞æÏïÑÏÑú ÌîÑÎ¶¨ÏÖãÎ™ÖÏùÑ Î∂ôÏó¨ Î≥µÏÇ¨Ìï©ÎãàÎã§.<br>
                        <strong>üìù ÏòàÏãú:</strong> <code>25FW-..._promotion_01.jpg</code> ‚Üí <code>25FW-..._promotion_01_lf.jpg</code>
                    </small>
                </div>
            </div>
            <div class="copy-buttons">
                <button class="btn-cancel" onclick="closeCopyModal()">Ï∑®ÏÜå</button>
                <button class="btn-primary" onclick="startCopy()">Î≥µÏÇ¨ ÏãúÏûë</button>
            </div>
        </div>
    </div>

    <!-- NAS Ï†ÑÏÜ° Modal -->
    <div id="nasModal" class="modal">
        <div class="nas-modal-content">
            <h3>üì° NAS Ïù¥ÎØ∏ÏßÄ Ï†ÑÏÜ°</h3>
            <div class="nas-form">
                <div class="form-group">
                    <label for="nasBasePath">Í∏∞Î≥∏ Í≤ΩÎ°ú</label>
                    <input type="text" id="nasBasePath" placeholder="NAS Í∏∞Î≥∏ Í≤ΩÎ°úÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="nasSeason">ÏãúÏ¶å</label>
                    <input type="text" id="nasSeason" placeholder="Ïòà: 25FW" maxlength="10">
                </div>
            </div>
            <div class="nas-buttons">
                <button class="btn-cancel" onclick="closeNasModal()">Ï∑®ÏÜå</button>
                <button class="btn-primary" onclick="startNasTransfer()">Ï†ÑÏÜ° ÏãúÏûë</button>
            </div>
        </div>
    </div>

    <!-- ÎèôÍ∏∞Ìôî ÏÑúÎ≤Ñ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú Modal -->
    <div id="deleteCopyModal" class="modal">
        <div class="copy-modal-content" style="max-width: 500px;">
            <h3>üóëÔ∏è ÎèôÍ∏∞Ìôî ÏÑúÎ≤Ñ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú</h3>
            <div class="copy-form">
                <div class="form-group">
                    <label for="deletePath">Í≤ΩÎ°ú</label>
                    <input type="text" id="deletePath" placeholder="Í≤ΩÎ°úÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                </div>
                <div class="form-group">
                    <label for="deleteSeason">ÏãúÏ¶å</label>
                    <input type="text" id="deleteSeason" placeholder="Ïòà: 25SS" maxlength="10">
                </div>
                <div class="form-group">
                    <label for="deletePreset">ÌîÑÎ¶¨ÏÖã ÏÑ†ÌÉù</label>
                    <select id="deletePreset">
                        <option value="">ÏÇ≠Ï†úÌï† ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    </select>
                </div>
                
                <!-- ÏÇ≠Ï†úÌï† Ïù¥ÎØ∏ÏßÄ ÌÉÄÏûÖ ÏÑ†ÌÉù -->
                <div class="form-group">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block;">ÏÇ≠Ï†úÌï† Ïù¥ÎØ∏ÏßÄ ÌÉÄÏûÖ ÏÑ†ÌÉù</label>
                    <div style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; background: #f8f9fa;">
                        <label style="display: flex; align-items: center; cursor: pointer; user-select: none; margin-bottom: 8px;">
                            <input type="checkbox" id="deletePatternImages" checked style="width: auto; margin-right: 8px;">
                            <span>üìÅ 1px CopyÎ°ú ÏÉùÏÑ±Îêú Ìå®ÌÑ¥ Ïù¥ÎØ∏ÏßÄ (Ïòà: promotion_01_musinsa.jpg)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer; user-select: none; margin-bottom: 8px;">
                            <input type="checkbox" id="deleteSyncImages" checked style="width: auto; margin-right: 8px;">
                            <span>üîÑ ÎèôÍ∏∞ÌôîÎ°ú ÏÉùÏÑ±Îêú Ïù¥ÎØ∏ÏßÄ (Ïòà: ABC123_musinsa.jpg)</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: not-allowed; user-select: none; opacity: 0.5;">
                            <input type="checkbox" id="deleteOriginalImages" disabled style="width: auto; margin-right: 8px;">
                            <span>üì∑ ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ (Ïòà: promotion_01.jpg) - <strong style="color: #dc3545;">ÏÇ≠Ï†ú Í∏àÏßÄ</strong></span>
                        </label>
                    </div>
                </div>
                
                <div class="warning-message">
                    ‚ö†Ô∏è ÏÑ†ÌÉùÌïú Ïù¥ÎØ∏ÏßÄ ÌÉÄÏûÖÎì§Ïù¥ Î™®Îëê ÏÇ≠Ï†úÎê©ÎãàÎã§!
                </div>
            </div>
            <div class="copy-buttons">
                <button class="btn-cancel" onclick="closeDeleteCopyModal()">Ï∑®ÏÜå</button>
                <button class="btn-danger" onclick="startDeleteCopy()">ÏÇ≠Ï†ú ÏãúÏûë</button>
            </div>
        </div>
    </div>


    <!-- Ìå®ÌÑ¥ ÏÑ§Ï†ï Modal -->
    <div id="patternSettingsModal" class="modal">
        <div class="copy-modal-content" style="max-width: 500px;">
            <h3>‚öôÔ∏è Î≥µÏÇ¨ Ìå®ÌÑ¥ ÏÑ§Ï†ï</h3>
            <div class="copy-form">
                <div style="margin-bottom: 15px;">
                    <small style="color: #666; font-size: 13px;">
                        Ï≤¥ÌÅ¨Îêú Ìå®ÌÑ¥Îßå Î≥µÏÇ¨Îê©ÎãàÎã§. HTML Ìå®ÌÑ¥ÏùÄ Î©îÏù∏ Ï≤¥ÌÅ¨Î∞ïÏä§Í∞Ä Ìï¥Ï†úÎêòÏñ¥ ÏûàÏúºÎ©¥ ÎπÑÌôúÏÑ±ÌôîÎê©ÎãàÎã§.
                    </small>
                </div>
                
                <div style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px; margin-bottom: 15px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #333;">ÏùºÎ∞ò Ìå®ÌÑ¥</h4>
                    <div class="pattern-checkbox-group">
                        <label class="pattern-checkbox-item">
                            <input type="checkbox" id="pattern_promotion_00" value="promotion_00" checked>
                            <span>promotion_00</span>
                        </label>
                        <label class="pattern-checkbox-item">
                            <input type="checkbox" id="pattern_promotion_01" value="promotion_01" checked>
                            <span>promotion_01</span>
                        </label>
                        <label class="pattern-checkbox-item">
                            <input type="checkbox" id="pattern_promotion_02" value="promotion_02" checked>
                            <span>promotion_02</span>
                        </label>
                        <label class="pattern-checkbox-item">
                            <input type="checkbox" id="pattern_fit_01" value="fit_01" checked>
                            <span>fit_01</span>
                        </label>
                        <label class="pattern-checkbox-item">
                            <input type="checkbox" id="pattern_illust_01" value="illust_01" checked>
                            <span>illust_01</span>
                        </label>
                    </div>
                </div>

                <div style="border: 1px solid #e0e0e0; border-radius: 6px; padding: 12px;">
                    <h4 style="margin: 0 0 10px 0; font-size: 14px; color: #333;">HTML Ìå®ÌÑ¥</h4>
                    <div class="pattern-checkbox-group">
                        <label class="pattern-checkbox-item html-pattern">
                            <input type="checkbox" id="pattern_desc_info_02" value="desc_info_02" checked>
                            <span>desc_info_02</span>
                        </label>
                        <label class="pattern-checkbox-item html-pattern">
                            <input type="checkbox" id="pattern_title_info_01" value="title_info_01" checked>
                            <span>title_info_01</span>
                        </label>
                        <label class="pattern-checkbox-item html-pattern">
                            <input type="checkbox" id="pattern_size_info_04" value="size_info_04" checked>
                            <span>size_info_04</span>
                        </label>
                        <label class="pattern-checkbox-item html-pattern">
                            <input type="checkbox" id="pattern_spec_info_03" value="spec_info_03" checked>
                            <span>spec_info_03</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="copy-buttons">
                <button class="btn-cancel" onclick="closePatternSettings()">Ï∑®ÏÜå</button>
                <button class="btn-primary" onclick="savePatternSettings()">ÌôïÏù∏</button>
            </div>
        </div>
    </div>


    <!-- Progress Modal -->
    <div id="progressModal" class="modal">
        <div class="progress-modal-content">
            <div id="progressContent">
                <h3 id="progressTitle">‚è≥ ÏûëÏóÖ ÏßÑÌñâ Ï§ë...</h3>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 0%;">0%</div>
                </div>
                <div class="progress-info">
                    <div class="progress-status" id="progressStatus">Ï§ÄÎπÑ Ï§ë...</div>
                    <div class="progress-time" id="progressTime">ÏòàÏÉÅ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: Í≥ÑÏÇ∞ Ï§ë...</div>
                </div>
                <div class="progress-details">
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">ÏÑ±Í≥µ</div>
                        <div class="progress-detail-value" id="progressProcessed">0</div>
                    </div>
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">Ï†ÑÏ≤¥</div>
                        <div class="progress-detail-value" id="progressTotal">0</div>
                    </div>
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">Ïò§Î•ò</div>
                        <div class="progress-detail-value" id="progressErrors" style="color: #dc3545;">0</div>
                    </div>
                </div>
            </div>
            <div id="progressCompleteContent" style="display: none;">
                <div class="progress-complete-icon">‚úÖ</div>
                <div class="progress-complete-message" id="completeMessage">ÏûëÏóÖ ÏôÑÎ£å!</div>
                <div class="progress-details">
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">ÏÑ±Í≥µ</div>
                        <div class="progress-detail-value" id="completedCount" style="color: #28a745;">0</div>
                    </div>
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">Ï†ÑÏ≤¥</div>
                        <div class="progress-detail-value" id="completedTotal">0</div>
                    </div>
                    <div class="progress-detail-item">
                        <div class="progress-detail-label">Ïò§Î•ò</div>
                        <div class="progress-detail-value" id="completedErrors" style="color: #dc3545;">0</div>
                    </div>
                </div>
                <div id="errorListContainer"></div>
                <button class="progress-close-btn" onclick="closeProgressModal()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>

    <!-- Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî Modal -->
    <div id="syncModal" class="modal">
        <div class="copy-modal-content">
            <h3>üîÑ Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî (ÏóëÏÖÄ Í∏∞Î∞ò)</h3>
            <div class="copy-form">
                <div class="form-group">
                    <label for="syncPath">Ïù¥ÎØ∏ÏßÄ Ìè¥Îçî Í≤ΩÎ°ú</label>
                    <input type="text" id="syncPath" placeholder="Ïòà: C:\images">
                </div>
                <div class="form-group">
                    <label for="syncSeason">ÏãúÏ¶å</label>
                    <input type="text" id="syncSeason" placeholder="Ïòà: 25FW" maxlength="10">
                </div>
                
                <!-- Ï†ÑÏ≤¥ ÎèôÍ∏∞Ìôî ÏòµÏÖò -->
                <div class="form-group">
                    <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                        <input type="checkbox" id="syncAllImages" style="width: auto; margin-right: 8px;" onchange="toggleSyncAllFields()">
                        <span>üåê Ï†ÑÏ≤¥ ÎèôÍ∏∞Ìôî (1px Ìå®ÌÑ¥ Ï†úÏô∏Ìïú Î™®Îì† Ïù¥ÎØ∏ÏßÄ)</span>
                    </label>
                </div>
                
                <div id="syncExcelFields">
                    <div class="form-group">
                        <label for="syncExcelFile">
                            ÏóëÏÖÄ ÌååÏùº (.xlsx, .xls)
                            <button type="button" onclick="downloadSampleExcel()" style="margin-left: 10px; padding: 4px 10px; font-size: 12px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üì• ÏÉòÌîå Îã§Ïö¥Î°úÎìú
                            </button>
                        </label>
                        <input type="file" id="syncExcelFile" accept=".xlsx,.xls,.ods">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="syncPreset">ÌîÑÎ¶¨ÏÖã ÏÑ†ÌÉù</label>
                    <select id="syncPreset">
                        <option value="">ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                    </select>
                </div>
                <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 6px; border: 1px solid #81c784;">
                    <small style="color: #2e7d32; font-size: 13px; line-height: 1.5;">
                        üìå <strong>ÎèôÏûë Î∞©Ïãù:</strong><br>
                        ‚Ä¢ Í≤ΩÎ°ú: <code>Ïù¥ÎØ∏ÏßÄ Ìè¥Îçî/ÏãúÏ¶å</code>ÏóêÏÑú Í≤ÄÏÉâ<br>
                        ‚Ä¢ <strong id="syncModeText">ÏóëÏÖÄÏùò "imgs" Ïó¥ Í∏∞Ï§Ä (Ïòà: SF177E-55NXFJ ‚Üí SF177E-55N_XFJ)</strong><br>
                        ‚Ä¢ ÏÑ†ÌÉùÌïú ÌîÑÎ¶¨ÏÖã ÌÅ¨Í∏∞Î°ú Î¶¨ÏÇ¨Ïù¥ÏßïÌïòÏó¨ Î≥µÏÇ¨<br>
                        ‚Ä¢ <strong>transparent Ìè¥ÎçîÎäî Ìï≠ÏÉÅ Ï†úÏô∏Îê©ÎãàÎã§</strong>
                    </small>
                </div>
            </div>
            <div class="copy-buttons">
                <button class="btn-cancel" onclick="closeSyncModal()">Ï∑®ÏÜå</button>
                <button class="btn-primary" onclick="startSync()">ÎèôÍ∏∞Ìôî ÏãúÏûë</button>
            </div>
        </div>
    </div>

        </div>
    </div>

    <script>
        // Form submission
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const width = document.getElementById('width').value;
            const height = document.getElementById('height').value;
            const images = document.getElementById('images').files;
            const basePath = document.getElementById('externalPath').value;
            
            if (!width || !height) {
                showResult('Please enter valid width and height values', 'error');
                return;
            }
            
            if (images.length === 0) {
                showResult('Please select at least one image', 'error');
                return;
            }
            
            if (!basePath || !basePath.trim()) {
                showResult('Please enter a base path in Browse External Folder', 'error');
                return;
            }
            
            // Add files to form data
            for (let i = 0; i < images.length; i++) {
                formData.append('images', images[i]);
            }
            formData.append('width', width);
            formData.append('height', height);
            formData.append('folderName', currentPresetName);
            formData.append('basePath', basePath);
            console.log('Sending to server:', { width, height, folderName: currentPresetName, basePath });
            
            // Show progress
            showProgress(true);
            document.getElementById('submitBtn').disabled = true;
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(`‚úÖ ${result.message}`, 'success');
                    
                    // Ïù¥ÎØ∏ÏßÄ Ï≤òÎ¶¨ ÏôÑÎ£å ÌõÑ Ïô∏Î∂Ä Ìè¥Îçî ÏÉàÎ°úÍ≥†Ïπ®
                    setTimeout(() => {
                        const externalPath = document.getElementById('externalPath').value;
                        if (externalPath && externalPath.trim() && !externalPath.startsWith('Local:')) {
                            browseExternalFolder();
                        }
                    }, 1000);
                } else {
                    showResult(`‚ùå ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error: ${error.message}`, 'error');
            } finally {
                showProgress(false);
                document.getElementById('submitBtn').disabled = false;
            }
        });
        
        function showProgress(show) {
            const progress = document.getElementById('progress');
            progress.style.display = show ? 'block' : 'none';
        }
        
        function showResult(message, type) {
            const result = document.getElementById('result');
            result.textContent = message;
            result.className = `result ${type}`;
            result.style.display = 'block';
            
            setTimeout(() => {
                result.style.display = 'none';
            }, 5000);
        }
        
        // Load folders and images
        
        function showFoldersView() {
            // Hide gallery view, show external folder section
            document.getElementById('galleryView').style.display = 'none';
            document.querySelector('.external-folder-section').style.display = 'block';
        }
        
        function openImageModal(url, name, size) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            modalImage.src = url;
            modalImage.alt = name;
            modalInfo.innerHTML = `
                <strong>${name}</strong><br>
                Size: ${formatFileSize(size)}
            `;
            
            modal.style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('imageModal').style.display = 'none';
        }
        
        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞ (Í∏∞Ï°¥ ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ÏôÄ ÌÜµÌï©Îê®)
        
        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        document.getElementById('imageModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeModal();
            }
        });
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        
        // Preset functions
        function openPresetWindow() {
            const presetWindow = window.open(
                'preset.html',
                'presetWindow',
                'width=600,height=700,scrollbars=yes,resizable=yes'
            );
        }
        
        let currentPresetName = '';
        
        function applyPreset(width, height, presetName) {
            document.getElementById('width').value = width;
            document.getElementById('height').value = height;
            currentPresetName = presetName || '';
            console.log('Applied preset:', { width, height, presetName, currentPresetName });
        }
        
        // Preset management functions
        let presets = [];
        
        // ÏÑúÎ≤ÑÏóêÏÑú ÌîÑÎ¶¨ÏÖã Î°úÎìú
        async function loadPresetsFromServer() {
            try {
                const response = await fetch('/api/presets');
                const data = await response.json();
                
                if (data.success) {
                    presets = data.presets;
                    loadPresets();
                } else {
                    console.error('Error loading presets:', data.message);
                    presets = [];
                }
            } catch (error) {
                console.error('Error loading presets:', error);
                presets = [];
            }
        }
        
        async function savePreset() {
            const width = document.getElementById('presetWidth').value;
            const height = document.getElementById('presetHeight').value;
            const name = document.getElementById('presetName').value;
            
            if (!width || !height || !name) {
                alert('Please fill in all fields');
                return;
            }
            
            try {
                const response = await fetch('/api/presets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name.trim(),
                        width: parseInt(width),
                        height: parseInt(height)
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    presets = data.presets;
                    
                    // Clear form
                    document.getElementById('presetWidth').value = '';
                    document.getElementById('presetHeight').value = '';
                    document.getElementById('presetName').value = '';
                    
                    loadPresets();
                    alert('Preset saved successfully!');
                } else {
                    alert(`Error: ${data.message}`);
                }
            } catch (error) {
                console.error('Error saving preset:', error);
                alert('Error saving preset');
            }
        }
        
        function loadPresets() {
            const container = document.getElementById('presetButtons');
            if (presets.length === 0) {
                container.innerHTML = '';
                return;
            }
            container.innerHTML = presets.map(preset => `
                <button class="preset-btn" onclick="applyPreset(${preset.width}, ${preset.height}, '${preset.name}')">
                    ${preset.name} (${preset.width}x${preset.height})
                </button>
            `).join('');
        }
        
        async function deletePreset(name, event) {
            event.stopPropagation();
            if (confirm(`Delete preset "${name}"?`)) {
                try {
                    const response = await fetch(`/api/presets/${encodeURIComponent(name)}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        presets = data.presets;
                        loadPresets();
                        alert('Preset deleted successfully!');
                    } else {
                        alert(`Error: ${data.message}`);
                    }
                } catch (error) {
                    console.error('Error deleting preset:', error);
                    alert('Error deleting preset');
                }
            }
        }
        
        // Listen for messages from preset window
        window.addEventListener('message', function(event) {
            if (event.data.type === 'applyPreset') {
                applyPreset(event.data.width, event.data.height, event.data.presetName);
            }
            if (event.data.type === 'presetSaved') {
                // localStorage Îã§Ïãú ÏùΩÏñ¥ÏÑú ÌîÑÎ¶¨ÏÖã ÏÉàÎ°úÍ≥†Ïπ®
                presets = JSON.parse(localStorage.getItem('imageResizerPresets') || '[]');
                loadPresets();
                
                // Ïô∏Î∂Ä Ìè¥Îçî ÏÉàÎ°úÍ≥†Ïπ®
                setTimeout(() => {
                    const externalPath = document.getElementById('externalPath').value;
                    if (externalPath && externalPath.trim() && !externalPath.startsWith('Local:')) {
                        browseExternalFolder();
                    }
                }, 500);
            }
        });
        
        // External folder browser
        async function browseExternalFolder() {
            const externalPath = document.getElementById('externalPath').value;
            
            if (!externalPath || !externalPath.trim()) {
                alert('Please enter a folder path');
                return;
            }
            
            try {
                const response = await fetch('/api/browse-external', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: externalPath })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    alert(`Error: ${data.message}`);
                    return;
                }
                
                // ÏÑ±Í≥µ Ïãú ÎßàÏßÄÎßâ Í≤ΩÎ°ú Ï†ÄÏû•
                localStorage.setItem('lastExternalPath', externalPath);
                
                displayExternalFolders(data.folders);
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        // ÎßàÏßÄÎßâ ÏÇ¨Ïö© Í≤ΩÎ°ú Î∂àÎü¨Ïò§Í∏∞
        function loadLastExternalPath() {
            const lastPath = localStorage.getItem('lastExternalPath');
            if (lastPath) {
                document.getElementById('externalPath').value = lastPath;
                // ÎßàÏßÄÎßâ Í≤ΩÎ°úÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèôÏúºÎ°ú Î∏åÎùºÏö∞Ïßï
                setTimeout(() => {
                    browseExternalFolder();
                }, 100);
            } else {
                // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
                document.getElementById('externalPath').value = 'C:\\Users\\PC\\Desktop\\new_work_busy\\img_resize\\node\\img_out';
                // Í∏∞Î≥∏ Í≤ΩÎ°úÎ°ú ÏûêÎèô Î∏åÎùºÏö∞Ïßï
                setTimeout(() => {
                    browseExternalFolder();
                }, 100);
            }
        }
        
        // Local folder selector
        function selectLocalFolder() {
            document.getElementById('folderSelector').click();
        }
        
        function handleFolderSelect(event) {
            const files = event.target.files;
            
            if (files.length === 0) {
                return;
            }
            
            // Ï≤´ Î≤àÏß∏ ÌååÏùºÏùò Í≤ΩÎ°úÏóêÏÑú Ìè¥Îçî Í≤ΩÎ°ú Ï∂îÏ∂ú
            const firstFile = files[0];
            const pathParts = firstFile.webkitRelativePath.split('/');
            const folderName = pathParts[0];
            
            // Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎì§ÏùÑ Ìè¥ÎçîÎ≥ÑÎ°ú Í∑∏Î£πÌôî
            const folderMap = new Map();
            
            for (const file of files) {
                // Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÌïÑÌÑ∞ÎßÅ
                if (/\.(jpg|jpeg|png|gif|webp)$/i.test(file.name)) {
                    const pathParts = file.webkitRelativePath.split('/');
                    
                    // ÏµúÏÉÅÏúÑ Ìè¥ÎçîÏùò ÏßÅÍ≥Ñ ÌïòÏúÑ Ìè¥ÎçîÎßå ÏÇ¨Ïö©
                    if (pathParts.length >= 2) {
                        const subFolder = pathParts[1];
                        
                        if (!folderMap.has(subFolder)) {
                            folderMap.set(subFolder, []);
                        }
                        
                        folderMap.get(subFolder).push({
                            name: file.name,
                            file: file,
                            size: file.size
                        });
                    }
                }
            }
            
            // Ìè¥Îçî Îç∞Ïù¥ÌÑ∞Î•º Î∞∞Ïó¥Î°ú Î≥ÄÌôò
            const folders = [];
            folderMap.forEach((images, folderName) => {
                folders.push({
                    name: folderName,
                    path: folderName,
                    imageCount: images.length,
                    images: images
                });
            });
            
            if (folders.length === 0) {
                alert('No image folders found in the selected folder');
                return;
            }
            
            // Í≤ΩÎ°ú ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
            const localPath = `Local: ${folderName}`;
            document.getElementById('externalPath').value = localPath;
            
            // ÎßàÏßÄÎßâ Í≤ΩÎ°ú Ï†ÄÏû•
            localStorage.setItem('lastExternalPath', localPath);
            
            // Î°úÏª¨ Ìè¥Îçî ÌëúÏãú
            displayLocalFolders(folders);
        }
        
        function displayLocalFolders(folders) {
            const container = document.getElementById('externalFoldersGrid');
            
            container.style.display = 'grid';
            container.innerHTML = folders.map((folder, index) => `
                <div class="folder-card" onclick="openLocalFolderGallery(${index})">
                    <button class="delete-btn" onclick="event.stopPropagation(); showDeleteModal('folder', '${folder.name}', ${index})" title="Delete folder">‚ùå</button>
                    <div class="folder-header">
                        <div class="folder-name">${folder.name}</div>
                        <div class="folder-count">${folder.imageCount} images</div>
                    </div>
                    <div class="images-grid">
                        ${folder.images.slice(0, 6).map((img, imgIndex) => `
                            <div class="image-item" id="localThumb_${index}_${imgIndex}">
                                <img src="#" alt="${img.name}" loading="lazy" style="display:none;">
                            </div>
                        `).join('')}
                        ${folder.images.length > 6 ? `<div class="image-item" style="background: #f8f9fa; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 0.9em;">+${folder.images.length - 6} more</div>` : ''}
                    </div>
                </div>
            `).join('');
            
            // Ïç∏ÎÑ§Ïùº Î°úÎìú
            folders.forEach((folder, folderIndex) => {
                folder.images.slice(0, 6).forEach((img, imgIndex) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imgElement = document.querySelector(`#localThumb_${folderIndex}_${imgIndex} img`);
                        if (imgElement) {
                            imgElement.src = e.target.result;
                            imgElement.style.display = 'block';
                        }
                    };
                    reader.readAsDataURL(img.file);
                });
            });
            
            // Ï†ÑÏó≠ Î≥ÄÏàòÏóê Ï†ÄÏû• (Í∞§Îü¨Î¶¨ÏóêÏÑú ÏÇ¨Ïö©)
            window.localFoldersData = folders;
        }
        
        function openLocalFolderGallery(folderIndex) {
            if (!window.localFoldersData || !window.localFoldersData[folderIndex]) {
                alert('Error loading folder data');
                return;
            }
            
            const folder = window.localFoldersData[folderIndex];
            
            // Hide folders view, show gallery view
            document.querySelector('.external-folder-section').style.display = 'none';
            document.getElementById('galleryView').style.display = 'block';
            
            // Set gallery title
            document.getElementById('galleryTitle').textContent = `üìÅ ${folder.name} (${folder.imageCount} images)`;
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ Í≤ΩÎ°ú Ï†ÄÏû• (Î°úÏª¨ Ìè¥ÎçîÏùò Í≤ΩÏö∞ Ìè¥ÎçîÎ™ÖÎßå)
            currentGalleryPath = folder.name;
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉú Ï†ÄÏû•
            currentGallery = {
                type: 'local',
                folderIndex: folderIndex,
                folderName: folder.name
            };
            
            // Load gallery images
            const galleryGrid = document.getElementById('galleryGrid');
            galleryGrid.innerHTML = folder.images.map((img, index) => `
                <div class="gallery-item" id="localGallery_${folderIndex}_${index}">
                    <button class="delete-btn" onclick="event.stopPropagation(); showDeleteModal('local-image', '${img.name}', {folderIndex: ${folderIndex}, imageIndex: ${index}})" title="Delete image">‚ùå</button>
                    <img src="#" alt="${img.name}" loading="lazy" style="display:none;">
                    <div class="gallery-item-info">
                        <div class="gallery-item-name">${img.name}</div>
                        <div class="gallery-item-size">${formatFileSize(img.size)}</div>
                    </div>
                </div>
            `).join('');
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú
            folder.images.forEach((img, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgElement = document.querySelector(`#localGallery_${folderIndex}_${index} img`);
                    if (imgElement) {
                        imgElement.src = e.target.result;
                        imgElement.style.display = 'block';
                        imgElement.onclick = function() {
                            openLocalImageModal(e.target.result, img.name, img.size);
                        };
                    }
                };
                reader.readAsDataURL(img.file);
            });
        }
        
        function openLocalImageModal(dataUrl, imageName, imageSize) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉú ÏÑ§Ï†ï
            currentGallery.images = getCurrentGalleryImages();
            currentGallery.currentIndex = getCurrentImageIndex(dataUrl);
            currentGallery.type = 'local';
            
            modalImage.src = dataUrl;
            modalImage.alt = imageName;
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ Ïã§Ï†ú ÌÅ¨Í∏∞ Í∞ÄÏ†∏Ïò§Í∏∞
            modalImage.onload = function() {
                const actualWidth = this.naturalWidth;
                const actualHeight = this.naturalHeight;
                modalInfo.innerHTML = `
                    <strong>${imageName}</strong><br>
                    Size: ${formatFileSize(imageSize)} | Dimensions: ${actualWidth} √ó ${actualHeight}px
                `;
            };
            
            modal.style.display = 'block';
        }
        
        function displayExternalFolders(folders) {
            const container = document.getElementById('externalFoldersGrid');
            
            if (!folders || folders.length === 0) {
                container.innerHTML = '<div class="no-images">No folders found in this path</div>';
                container.style.display = 'block';
                return;
            }
            
            container.style.display = 'grid';
            container.innerHTML = folders.map((folder, index) => `
                <div class="folder-card" onclick="openExternalFolderGallery('${folder.path.replace(/\\/g, '\\\\')}', '${folder.name}')">
                    <button class="delete-btn" onclick="event.stopPropagation(); showDeleteModal('external-folder', '${folder.name}', '${folder.path.replace(/\\/g, '\\\\')}')" title="Delete folder">‚ùå</button>
                    <div class="folder-header">
                        <div class="folder-name">${folder.name}</div>
                        <div class="folder-count">${folder.imageCount} images</div>
                    </div>
                    <div class="images-grid">
                        ${folder.images.slice(0, 6).map(img => `
                            <div class="image-item">
                                <img src="/api/external-image?path=${encodeURIComponent(img.path)}" alt="${img.name}" loading="lazy" onerror="this.style.display='none'">
                            </div>
                        `).join('')}
                        ${folder.images.length > 6 ? `<div class="image-item" style="background: #f8f9fa; display: flex; align-items: center; justify-content: center; color: #6c757d; font-size: 0.9em;">+${folder.images.length - 6} more</div>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function openExternalFolderGallery(folderPath, folderName) {
            // Hide folders view, show gallery view
            document.querySelector('.external-folder-section').style.display = 'none';
            document.getElementById('galleryView').style.display = 'block';
            
            // Set gallery title
            document.getElementById('galleryTitle').textContent = `üìÅ ${folderName}`;
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ Í≤ΩÎ°ú Ï†ÄÏû•
            currentGalleryPath = folderPath;
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉú Ï†ÄÏû•
            currentGallery = {
                type: 'external',
                folderPath: folderPath,
                folderName: folderName
            };
            
            // Load gallery images from external folder
            loadExternalGallery(folderPath, folderName);
        }
        
        async function loadExternalGallery(folderPath, folderName) {
            try {
                const response = await fetch('/api/browse-external', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: folderPath, includeImages: true })
                });
                
                const data = await response.json();
                
                if (!data.success || !data.images) {
                    document.getElementById('galleryGrid').innerHTML = '<div class="no-images">Error loading images</div>';
                    return;
                }
                
                const galleryGrid = document.getElementById('galleryGrid');
                galleryGrid.innerHTML = data.images.map((img, index) => `
                    <div class="gallery-item" onclick="openExternalImageModal('${img.path.replace(/\\/g, '\\\\')}', '${img.name}', ${img.size})">
                        <button class="delete-btn" onclick="event.stopPropagation(); showDeleteModal('external-image', '${img.name}', '${img.path.replace(/\\/g, '\\\\')}')" title="Delete image">‚ùå</button>
                        <img src="/api/external-image?path=${encodeURIComponent(img.path)}" alt="${img.name}" loading="lazy">
                        <div class="gallery-item-info">
                            <div class="gallery-item-name">${img.name}</div>
                            <div class="gallery-item-size">${formatFileSize(img.size)}</div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('galleryGrid').innerHTML = '<div class="no-images">Error: ' + error.message + '</div>';
            }
        }
        
        function openExternalImageModal(imagePath, imageName, imageSize) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉú ÏÑ§Ï†ï
            currentGallery.images = getCurrentGalleryImages();
            const imageSrc = `/api/external-image?path=${encodeURIComponent(imagePath)}`;
            currentGallery.currentIndex = getCurrentImageIndex(imageSrc);
            currentGallery.type = 'external';
            
            modalImage.src = imageSrc;
            modalImage.alt = imageName;
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ Ïã§Ï†ú ÌÅ¨Í∏∞ Í∞ÄÏ†∏Ïò§Í∏∞
            modalImage.onload = function() {
                const actualWidth = this.naturalWidth;
                const actualHeight = this.naturalHeight;
                modalInfo.innerHTML = `
                    <strong>${imageName}</strong><br>
                    Size: ${formatFileSize(imageSize)} | Dimensions: ${actualWidth} √ó ${actualHeight}px
                `;
            };
            
            modal.style.display = 'block';
        }
        
        // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉú Ï†ÄÏû•
        let currentGallery = {
            type: null, // 'external' or 'local'
            images: [],
            currentIndex: 0,
            folderPath: null
        };

        // Í∞§Îü¨Î¶¨ Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        function getCurrentGalleryImages() {
            const galleryItems = document.querySelectorAll('.gallery-item');
            const images = [];
            
            galleryItems.forEach((item, index) => {
                const img = item.querySelector('img');
                const nameElement = item.querySelector('.gallery-item-name');
                const sizeElement = item.querySelector('.gallery-item-size');
                
                if (img && nameElement) {
                    images.push({
                        src: img.src,
                        name: nameElement.textContent,
                        size: sizeElement ? sizeElement.textContent : '',
                        index: index
                    });
                }
            });
            
            return images;
        }

        // ÌòÑÏû¨ Ïù¥ÎØ∏ÏßÄ Ïù∏Îç±Ïä§ Ï∞æÍ∏∞
        function getCurrentImageIndex(targetSrc) {
            const images = getCurrentGalleryImages();
            return images.findIndex(img => img.src === targetSrc);
        }

        // Ïù¥Ï†Ñ Ïù¥ÎØ∏ÏßÄÎ°ú Ïù¥Îèô
        function showPreviousImage() {
            if (currentGallery.images.length === 0) return;
            
            currentGallery.currentIndex = (currentGallery.currentIndex - 1 + currentGallery.images.length) % currentGallery.images.length;
            showImageAtIndex(currentGallery.currentIndex);
        }

        // Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎ°ú Ïù¥Îèô
        function showNextImage() {
            if (currentGallery.images.length === 0) return;
            
            currentGallery.currentIndex = (currentGallery.currentIndex + 1) % currentGallery.images.length;
            showImageAtIndex(currentGallery.currentIndex);
        }

        // ÌäπÏ†ï Ïù∏Îç±Ïä§Ïùò Ïù¥ÎØ∏ÏßÄ ÌëúÏãú
        function showImageAtIndex(index) {
            if (index < 0 || index >= currentGallery.images.length) return;
            
            const image = currentGallery.images[index];
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalInfo = document.getElementById('modalInfo');
            
            modalImg.src = image.src;
            modalImg.alt = image.name;
            
            // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÌõÑ Ïã§Ï†ú ÌÅ¨Í∏∞ Í∞ÄÏ†∏Ïò§Í∏∞
            modalImg.onload = function() {
                const actualWidth = this.naturalWidth;
                const actualHeight = this.naturalHeight;
                modalInfo.innerHTML = `
                    <strong>${image.name}</strong><br>
                    Size: ${image.size} | Dimensions: ${actualWidth} √ó ${actualHeight}px
                `;
            };
            
            currentGallery.currentIndex = index;
        }

        // ÌÇ§Î≥¥Îìú Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨
        document.addEventListener('keydown', function(event) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                if (event.key === 'Escape') {
                    closeModal();
                } else if (event.key === 'ArrowLeft') {
                    event.preventDefault();
                    showPreviousImage();
                } else if (event.key === 'ArrowRight') {
                    event.preventDefault();
                    showNextImage();
                }
            }
        });

        // ÎßàÏö∞Ïä§ Ìú† Ïù¥Î≤§Ìä∏ Ï≤òÎ¶¨ (Ïä§ÌÅ¨Î°§Î°ú Ïù¥ÎØ∏ÏßÄ ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò)
        document.addEventListener('wheel', function(event) {
            const modal = document.getElementById('imageModal');
            if (modal.style.display === 'block') {
                event.preventDefault(); // Í∏∞Î≥∏ Ïä§ÌÅ¨Î°§ ÎèôÏûë Î∞©ÏßÄ
                
                // Ïä§ÌÅ¨Î°§ Î∞©Ìñ•Ïóê Îî∞Îùº Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω
                if (event.deltaY > 0) {
                    // ÏïÑÎûòÎ°ú Ïä§ÌÅ¨Î°§ = Îã§Ïùå Ïù¥ÎØ∏ÏßÄ
                    showNextImage();
                } else if (event.deltaY < 0) {
                    // ÏúÑÎ°ú Ïä§ÌÅ¨Î°§ = Ïù¥Ï†Ñ Ïù¥ÎØ∏ÏßÄ
                    showPreviousImage();
                }
            }
        }, { passive: false }); // passive: falseÎ°ú ÏÑ§Ï†ïÌïòÏó¨ preventDefault() ÏÇ¨Ïö© Í∞ÄÎä•

        // ÏÇ≠Ï†ú Í¥ÄÎ†® Î≥ÄÏàò
        let deleteTarget = null;

        // 1px Î≥µÏÇ¨ Í¥ÄÎ†® Î≥ÄÏàò
        let currentGalleryPath = null;

        // NAS Í¥ÄÎ†® Î≥ÄÏàò
        let nasSettings = {
            defaultPath: '\\\\nas\\images',
            backupPath: '\\\\nas\\backup'
        };

        // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ Í¥ÄÎ†® Î≥ÄÏàò
        let progressStartTime = 0;
        let progressInterval = null;
        let deleteConfirmCallback = null;

        // ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ ÌëúÏãú
        function showDeleteConfirmModal(title, message, warning, callback) {
            const modal = document.getElementById('deleteConfirmModal');
            document.getElementById('deleteConfirmTitle').textContent = title;
            document.getElementById('deleteConfirmMessage').innerHTML = message;
            document.getElementById('deleteConfirmWarning').textContent = warning;
            
            deleteConfirmCallback = callback;
            modal.style.display = 'block';
        }

        // ÏÇ≠Ï†ú ÌôïÏù∏ Î™®Îã¨ Îã´Í∏∞
        function closeDeleteConfirmModal() {
            document.getElementById('deleteConfirmModal').style.display = 'none';
            deleteConfirmCallback = null;
        }

        // ÏÇ≠Ï†ú ÌôïÏù∏
        function confirmDeleteAction() {
            closeDeleteConfirmModal();
            if (deleteConfirmCallback) {
                deleteConfirmCallback();
            }
        }

        // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ Ïó¥Í∏∞
        function showProgressModal(title) {
            const modal = document.getElementById('progressModal');
            const progressContent = document.getElementById('progressContent');
            const completeContent = document.getElementById('progressCompleteContent');
            
            // Ï¥àÍ∏∞Ìôî
            progressContent.style.display = 'block';
            completeContent.style.display = 'none';
            
            document.getElementById('progressTitle').textContent = title || '‚è≥ ÏûëÏóÖ ÏßÑÌñâ Ï§ë...';
            document.getElementById('progressBarFill').style.width = '0%';
            document.getElementById('progressBarFill').textContent = '0%';
            document.getElementById('progressStatus').textContent = 'Ï§ÄÎπÑ Ï§ë...';
            document.getElementById('progressTime').textContent = 'ÏòàÏÉÅ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: Í≥ÑÏÇ∞ Ï§ë...';
            document.getElementById('progressProcessed').textContent = '0';
            document.getElementById('progressTotal').textContent = '0';
            document.getElementById('progressErrors').textContent = '0';
            
            progressStartTime = Date.now();
            modal.style.display = 'block';
        }

        // ÌîÑÎ°úÍ∑∏Î†àÏä§ ÏóÖÎç∞Ïù¥Ìä∏
        function updateProgress(processed, total, currentFile = '') {
            const percentage = total > 0 ? Math.round((processed / total) * 100) : 0;
            
            document.getElementById('progressBarFill').style.width = percentage + '%';
            document.getElementById('progressBarFill').textContent = percentage + '%';
            document.getElementById('progressProcessed').textContent = processed;
            document.getElementById('progressTotal').textContent = total;
            
            if (currentFile) {
                document.getElementById('progressStatus').textContent = `Ï≤òÎ¶¨ Ï§ë: ${currentFile}`;
            }
            
            // ÎÇ®ÏùÄ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
            if (processed > 0) {
                const elapsed = (Date.now() - progressStartTime) / 1000; // Ï¥à
                const avgTimePerItem = elapsed / processed;
                const remaining = (total - processed) * avgTimePerItem;
                
                const minutes = Math.floor(remaining / 60);
                const seconds = Math.floor(remaining % 60);
                
                if (minutes > 0) {
                    document.getElementById('progressTime').textContent = 
                        `ÏòàÏÉÅ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${minutes}Î∂Ñ ${seconds}Ï¥à`;
                } else {
                    document.getElementById('progressTime').textContent = 
                        `ÏòàÏÉÅ ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${seconds}Ï¥à`;
                }
            }
        }

        // ÌîÑÎ°úÍ∑∏Î†àÏä§ ÏôÑÎ£å ÌôîÎ©¥ ÌëúÏãú
        function showProgressComplete(result) {
            const progressContent = document.getElementById('progressContent');
            const completeContent = document.getElementById('progressCompleteContent');
            
            progressContent.style.display = 'none';
            completeContent.style.display = 'block';
            
            // Ï≤òÎ¶¨Îêú Ïù¥ÎØ∏ÏßÄ Í∞úÏàò
            const processed = result.copiedCount || result.resizedCount || result.transferredCount || result.deletedCount || 0;
            const errors = result.errors || [];
            const errorCount = errors.length;
            const successCount = processed - errorCount;
            
            // Í≤∞Í≥º Î©îÏãúÏßÄ
            let message = 'ÏûëÏóÖ ÏôÑÎ£å!';
            
            // Í∞Å ÏûëÏóÖ ÌÉÄÏûÖÎ≥Ñ Î©îÏãúÏßÄ
            if (result.resizedCount !== undefined) {
                message = `üé® Î¶¨ÏÇ¨Ïù¥Ïßï ÏôÑÎ£å! (${successCount}Í∞ú ÏÑ±Í≥µ)`;
            } else if (result.copiedCount !== undefined) {
                message = `üìã Î≥µÏÇ¨ ÏôÑÎ£å! (${successCount}Í∞ú ÏÑ±Í≥µ)`;
            } else if (result.transferredCount !== undefined) {
                message = `üì° Ï†ÑÏÜ° ÏôÑÎ£å! (${successCount}Í∞ú ÏÑ±Í≥µ)`;
            } else if (result.deletedCount !== undefined) {
                message = `üóëÔ∏è ÏÇ≠Ï†ú ÏôÑÎ£å! (${successCount}Í∞ú ÏÑ±Í≥µ)`;
            }
            
            document.getElementById('completeMessage').textContent = message;
            document.getElementById('completedCount').textContent = successCount;
            document.getElementById('completedTotal').textContent = processed;
            document.getElementById('completedErrors').textContent = errorCount;
            
            // Ïò§Î•ò Î™©Î°ù ÌëúÏãú
            const errorContainer = document.getElementById('errorListContainer');
            if (errorCount > 0) {
                const errorList = errors.slice(0, 10).map(err => `‚Ä¢ ${err}`).join('<br>');
                const moreText = errors.length > 10 ? `<br>... Ïô∏ ${errors.length - 10}Í∞ú Îçî` : '';
                errorContainer.innerHTML = `
                    <div class="progress-error-list">
                        <strong>‚ö†Ô∏è Ïò§Î•ò Î™©Î°ù:</strong><br>
                        ${errorList}${moreText}
                    </div>
                `;
            } else {
                errorContainer.innerHTML = `
                    <div style="text-align: center; color: #28a745; font-size: 14px; margin-top: 15px;">
                        ‚ú® Î™®Îì† ÏûëÏóÖÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§!
                    </div>
                `;
            }
        }

        // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ Îã´Í∏∞
        function closeProgressModal() {
            document.getElementById('progressModal').style.display = 'none';
            
            // Í∞§Îü¨Î¶¨ ÏÉàÎ°úÍ≥†Ïπ®
            if (currentGalleryPath) {
                setTimeout(() => {
                    browseExternalGallery(currentGalleryPath);
                }, 300);
            }
        }

        // ÏÇ≠Ï†ú Î™®Îã¨ ÌëúÏãú
        function showDeleteModal(type, name, data) {
            deleteTarget = { type, name, data };
            const modal = document.getElementById('deleteModal');
            const message = document.getElementById('deleteMessage');
            
            let messageText = '';
            if (type === 'folder' || type === 'external-folder') {
                messageText = `Ìè¥Îçî "${name}"ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
            } else if (type === 'local-image' || type === 'external-image') {
                messageText = `Ïù¥ÎØ∏ÏßÄ "${name}"ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`;
            }
            
            message.textContent = messageText;
            modal.style.display = 'block';
        }

        // ÏÇ≠Ï†ú Î™®Îã¨ Îã´Í∏∞
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
            deleteTarget = null;
        }

        // ÏÇ≠Ï†ú ÌôïÏù∏
        async function confirmDelete() {
            if (!deleteTarget) return;

            try {
                let success = false;
                
                if (deleteTarget.type === 'folder') {
                    // Î°úÏª¨ Ìè¥Îçî ÏÇ≠Ï†ú (Ïã§Ï†úÎ°úÎäî Ìè¥ÎçîÏóêÏÑú Ï†úÍ±∞Îßå)
                    success = await deleteLocalFolder(deleteTarget.data);
                } else if (deleteTarget.type === 'external-folder') {
                    // Ïô∏Î∂Ä Ìè¥Îçî ÏÇ≠Ï†ú
                    success = await deleteExternalFolder(deleteTarget.data);
                } else if (deleteTarget.type === 'local-image') {
                    // Î°úÏª¨ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
                    success = await deleteLocalImage(deleteTarget.data);
                } else if (deleteTarget.type === 'external-image') {
                    // Ïô∏Î∂Ä Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
                    success = await deleteExternalImage(deleteTarget.data);
                }

               if (success) {
                   showResult(`‚úÖ ${deleteTarget.name}Ïù¥(Í∞Ä) ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.`, 'success');
                   closeDeleteModal();

                   // Í∞§Îü¨Î¶¨ ÏÉàÎ°úÍ≥†Ïπ®
                   setTimeout(() => {
                       // ÌòÑÏû¨ Í∞§Îü¨Î¶¨ ÏÉÅÌÉúÏóê Îî∞Îùº ÏÉàÎ°úÍ≥†Ïπ®
                       if (currentGallery && currentGallery.type === 'external') {
                           // Ïô∏Î∂Ä Í∞§Îü¨Î¶¨Ïù∏ Í≤ΩÏö∞
                           const externalPath = document.getElementById('externalPath').value;
                           if (externalPath && externalPath.trim() && !externalPath.startsWith('Local:')) {
                               browseExternalFolder();
                           }
                       } else if (currentGallery && currentGallery.type === 'local') {
                           // Î°úÏª¨ Í∞§Îü¨Î¶¨Ïù∏ Í≤ΩÏö∞
                           const folderIndex = currentGallery.folderIndex;
                           if (window.localFoldersData && window.localFoldersData[folderIndex]) {
                               openLocalFolderGallery(folderIndex);
                           }
                       } else {
                           // ÏùºÎ∞òÏ†ÅÏù∏ ÏÉàÎ°úÍ≥†Ïπ®
                           const externalPath = document.getElementById('externalPath').value;
                           if (externalPath && externalPath.trim() && !externalPath.startsWith('Local:')) {
                               browseExternalFolder();
                           }
                       }
                   }, 300);
               } else {
                   showResult(`‚ùå ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.`, 'error');
               }
            } catch (error) {
                console.error('Delete error:', error);
                showResult(`‚ùå ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}`, 'error');
            }
        }

        // Î°úÏª¨ Ìè¥Îçî ÏÇ≠Ï†ú
        async function deleteLocalFolder(folderIndex) {
            if (!window.localFoldersData || !window.localFoldersData[folderIndex]) {
                return false;
            }
            
            // Ìè¥Îçî Îç∞Ïù¥ÌÑ∞ÏóêÏÑú Ï†úÍ±∞
            window.localFoldersData.splice(folderIndex, 1);
            
            // UI ÏÉàÎ°úÍ≥†Ïπ®
            displayLocalFolders(window.localFoldersData);
            return true;
        }

        // Ïô∏Î∂Ä Ìè¥Îçî ÏÇ≠Ï†ú
        async function deleteExternalFolder(folderPath) {
            try {
                const response = await fetch('/api/delete-folder', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: folderPath })
                });
                
                const data = await response.json();
                return data.success;
            } catch (error) {
                console.error('Delete external folder error:', error);
                return false;
            }
        }

        // Î°úÏª¨ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
        async function deleteLocalImage(data) {
            if (!window.localFoldersData || !window.localFoldersData[data.folderIndex]) {
                return false;
            }
            
            // Ìè¥ÎçîÏóêÏÑú Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞
            window.localFoldersData[data.folderIndex].images.splice(data.imageIndex, 1);
            window.localFoldersData[data.folderIndex].imageCount--;
            
            // UI ÏÉàÎ°úÍ≥†Ïπ®
            displayLocalFolders(window.localFoldersData);
            return true;
        }

        // Ïô∏Î∂Ä Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú
        async function deleteExternalImage(imagePath) {
            try {
                const response = await fetch('/api/delete-image', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ path: imagePath })
                });
                
                const data = await response.json();
                return data.success;
            } catch (error) {
                console.error('Delete external image error:', error);
                return false;
            }
        }

        // 1px Î≥µÏÇ¨ Î™®Îã¨ Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openCopyModal() {
            const modal = document.getElementById('copyModal');
            modal.style.display = 'block';
            
            // ÌîÑÎ¶¨ÏÖã Î™©Î°ù Î°úÎìú
            loadPresetsForCopy();
        }

        function closeCopyModal() {
            document.getElementById('copyModal').style.display = 'none';
        }

        function toggleExcelFilterFields() {
            const useExcelFilter = document.getElementById('useExcelFilter').checked;
            const excelFields = document.getElementById('excelFilterFields');
            
            if (useExcelFilter) {
                excelFields.style.display = 'block';
            } else {
                excelFields.style.display = 'none';
            }
        }

        function openDeleteCopyModal() {
            const modal = document.getElementById('deleteCopyModal');
            modal.style.display = 'block';
            
            // ÌîÑÎ¶¨ÏÖã Î™©Î°ù Î°úÎìú
            loadPresetsForDelete();
        }

        function closeDeleteCopyModal() {
            document.getElementById('deleteCopyModal').style.display = 'none';
        }


        async function loadPresetsForCopy() {
            try {
                const response = await fetch('/api/presets');
                const data = await response.json();
                
                const select = document.getElementById('copyPreset');
                select.innerHTML = '<option value="">ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (data.success && data.presets.length > 0) {
                    data.presets.forEach(preset => {
                        const option = document.createElement('option');
                        option.value = preset.name;
                        option.textContent = `${preset.name} (${preset.width}x${preset.height})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading presets for copy:', error);
            }
        }

        async function loadPresetsForDelete() {
            try {
                const response = await fetch('/api/presets');
                const data = await response.json();
                
                const select = document.getElementById('deletePreset');
                select.innerHTML = '<option value="">ÏÇ≠Ï†úÌï† ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (data.success && data.presets.length > 0) {
                    data.presets.forEach(preset => {
                        const option = document.createElement('option');
                        option.value = preset.name;
                        option.textContent = `${preset.name} (${preset.width}x${preset.height})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading presets for delete:', error);
            }
        }


        // Ìå®ÌÑ¥ ÏÑ§Ï†ï Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openPatternSettings() {
            const modal = document.getElementById('patternSettingsModal');
            modal.style.display = 'block';
            
            // ÌòÑÏû¨ HTML Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉúÏóê Îî∞Îùº HTML Ìå®ÌÑ¥ ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
            toggleHtmlPatterns();
        }

        function closePatternSettings() {
            document.getElementById('patternSettingsModal').style.display = 'none';
        }

        function toggleHtmlPatterns() {
            const htmlIncluded = document.getElementById('copyHtmlImages').checked;
            const htmlPatternItems = document.querySelectorAll('.pattern-checkbox-item.html-pattern');
            const htmlPatternCheckboxes = document.querySelectorAll('.pattern-checkbox-item.html-pattern input[type="checkbox"]');
            
            htmlPatternItems.forEach(item => {
                if (htmlIncluded) {
                    item.classList.remove('disabled');
                } else {
                    item.classList.add('disabled');
                }
            });
            
            htmlPatternCheckboxes.forEach(checkbox => {
                checkbox.disabled = !htmlIncluded;
            });
        }

        function savePatternSettings() {
            // Ìå®ÌÑ¥ ÏÑ§Ï†ï Ï†ÄÏû• (localStorageÏóê Ï†ÄÏû•)
            const patterns = {
                promotion_00: document.getElementById('pattern_promotion_00').checked,
                promotion_01: document.getElementById('pattern_promotion_01').checked,
                promotion_02: document.getElementById('pattern_promotion_02').checked,
                fit_01: document.getElementById('pattern_fit_01').checked,
                illust_01: document.getElementById('pattern_illust_01').checked,
                desc_info_02: document.getElementById('pattern_desc_info_02').checked,
                title_info_01: document.getElementById('pattern_title_info_01').checked,
                size_info_04: document.getElementById('pattern_size_info_04').checked,
                spec_info_03: document.getElementById('pattern_spec_info_03').checked
            };
            
            localStorage.setItem('copyPatterns', JSON.stringify(patterns));
            closePatternSettings();
        }

        function loadPatternSettings() {
            const saved = localStorage.getItem('copyPatterns');
            if (saved) {
                const patterns = JSON.parse(saved);
                Object.keys(patterns).forEach(key => {
                    const checkbox = document.getElementById(`pattern_${key}`);
                    if (checkbox) {
                        checkbox.checked = patterns[key];
                    }
                });
            }
        }

        function getEnabledPatterns() {
            
            const patterns = [];
            const allPatternIds = [
                'promotion_00', 'promotion_01', 'promotion_02',
                'fit_01', 'illust_01',
                'desc_info_02', 'title_info_01', 'size_info_04', 'spec_info_03'
            ];
            
            allPatternIds.forEach(id => {
                const checkbox = document.getElementById(`pattern_${id}`);
                if (checkbox && checkbox.checked && !checkbox.disabled) {
                    patterns.push(id);
                }
            });
            
            return patterns;
        }

        async function startCopy() {
            const path = document.getElementById('copyPath').value.trim();
            const season = document.getElementById('copySeason').value.trim();
            const presetName = document.getElementById('copyPreset').value.trim();
            const includeHtmlImages = document.getElementById('copyHtmlImages').checked;
            const enabledPatterns = getEnabledPatterns();
            const useExcelFilter = document.getElementById('useExcelFilter').checked;
            
            if (!path || !season || !presetName) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ ÌëúÏãú
            showProgressModal('üìÅ 1px Copy ÏßÑÌñâ Ï§ë...');
            closeCopyModal();
            
            // ÏóëÏÖÄ ÌïÑÌÑ∞ÎßÅ ÏÇ¨Ïö© Ïãú
            if (useExcelFilter) {
                const excelFile = document.getElementById('copyExcelFile').files[0];
                
                if (!excelFile) {
                    closeProgressModal();
                    alert('ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                try {
                    updateProgress(0, 1, 'ÏóëÏÖÄ ÌååÏùº Î∂ÑÏÑù Ï§ë...');
                    
                    const formData = new FormData();
                    formData.append('excelFile', excelFile);
                    formData.append('sourcePath', path);
                    formData.append('season', season);
                    formData.append('presetName', presetName);
                    formData.append('includeHtmlImages', includeHtmlImages);
                    formData.append('enabledPatterns', JSON.stringify(enabledPatterns));
                    
                    const response = await fetch('/api/copy-images-excel', {
                        method: 'POST',
                        body: formData
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showProgressComplete(data);
                    } else {
                        closeProgressModal();
                        alert(`Ïò§Î•ò: ${data.message}`);
                    }
                } catch (error) {
                    console.error('Error copying images with excel:', error);
                    closeProgressModal();
                    alert('ÏóëÏÖÄ ÌïÑÌÑ∞ÎßÅ Î≥µÏÇ¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
                }
                
                return;
            }
            
            // Í∏∞Ï°¥ Î∞©Ïãù (Ìå®ÌÑ¥ Í∏∞Î∞ò)
            if (enabledPatterns.length === 0) {
                closeProgressModal();
                alert('Î≥µÏÇ¨Ìï† Ìå®ÌÑ¥ÏùÑ ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            try {
                updateProgress(0, 1, 'Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ Ï§ë...');
                
                const response = await fetch('/api/copy-images', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourcePath: path,
                        season: season,
                        presetName: presetName,
                        includeHtmlImages: includeHtmlImages,
                        enabledPatterns: enabledPatterns,
                        targetPath: currentGalleryPath
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showProgressComplete(data);
                } else {
                    closeProgressModal();
                    alert(`Ïò§Î•ò: ${data.message}`);
                }
            } catch (error) {
                console.error('Error copying images:', error);
                closeProgressModal();
                alert('Ïù¥ÎØ∏ÏßÄ Î≥µÏÇ¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        async function startDeleteCopy() {
            const path = document.getElementById('deletePath').value.trim();
            const season = document.getElementById('deleteSeason').value.trim();
            const presetName = document.getElementById('deletePreset').value.trim();
            
            // ÏÇ≠Ï†úÌï† Ïù¥ÎØ∏ÏßÄ ÌÉÄÏûÖ ÌôïÏù∏
            const deletePatternImages = document.getElementById('deletePatternImages').checked;
            const deleteSyncImages = document.getElementById('deleteSyncImages').checked;
            // ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄÎäî Ï†àÎåÄ ÏÇ≠Ï†úÌïòÏßÄ ÏïäÏùå
            
            if (!path || !season || !presetName) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            if (!deletePatternImages && !deleteSyncImages) {
                alert('ÏÇ≠Ï†úÌï† Ïù¥ÎØ∏ÏßÄ ÌÉÄÏûÖÏùÑ ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÏÑ†ÌÉùÎêú ÌÉÄÏûÖÎì§ ÌëúÏãú
            const selectedTypes = [];
            if (deletePatternImages) selectedTypes.push('1px Copy Ìå®ÌÑ¥ Ïù¥ÎØ∏ÏßÄ');
            if (deleteSyncImages) selectedTypes.push('ÎèôÍ∏∞Ìôî Ïù¥ÎØ∏ÏßÄ');
            
            // Í∏∞Î≥∏ confirm ÏÇ¨Ïö©
            if (!confirm(`Ï†ïÎßêÎ°ú "${presetName}" ÌîÑÎ¶¨ÏÖãÍ≥º Í¥ÄÎ†®Îêú Îã§Ïùå Ïù¥ÎØ∏ÏßÄÎì§ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÏÑ†ÌÉùÎêú ÌÉÄÏûÖ: ${selectedTypes.join(', ')}\n\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§!`)) {
                return;
            }
            
            // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ ÌëúÏãú
            showProgressModal('üóëÔ∏è ÎèôÍ∏∞Ìôî ÏÑúÎ≤Ñ Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú ÏßÑÌñâ Ï§ë...');
            closeDeleteCopyModal();
            
            try {
                updateProgress(0, 1, 'Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ Ï§ë...');
                
                const response = await fetch('/api/delete-sync-images', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        sourcePath: path,
                        season: season,
                        presetName: presetName,
                        deletePatternImages: deletePatternImages,
                        deleteSyncImages: deleteSyncImages,
                        deleteOriginalImages: false // ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄÎäî Ï†àÎåÄ ÏÇ≠Ï†úÌïòÏßÄ ÏïäÏùå
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showProgressComplete(data);
                } else {
                    closeProgressModal();
                    alert(`Ïò§Î•ò: ${data.message}`);
                }
            } catch (error) {
                console.error('Error deleting sync images:', error);
                closeProgressModal();
                alert('Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }


        // NAS Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openNasModal() {
            const modal = document.getElementById('nasModal');
            modal.style.display = 'block';
            
            // NAS Í∏∞Î≥∏ Í≤ΩÎ°ú ÏÑ§Ï†ï (ÎßàÏßÄÎßâ ÏÇ¨Ïö©Ìïú Í≤ΩÎ°ú ÎòêÎäî Í∏∞Î≥∏Í∞í)
            const lastNasPath = localStorage.getItem('lastNasPath');
            if (lastNasPath) {
                document.getElementById('nasBasePath').value = lastNasPath;
            } else {
                document.getElementById('nasBasePath').value = nasSettings.defaultPath;
            }
        }

        function closeNasModal() {
            document.getElementById('nasModal').style.display = 'none';
        }

        async function startNasTransfer() {
            const basePath = document.getElementById('nasBasePath').value.trim();
            const season = document.getElementById('nasSeason').value.trim();
            
            if (!basePath || !season) {
                alert('Î™®Îì† ÌïÑÎìúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÎßàÏßÄÎßâ ÏÇ¨Ïö©Ìïú NAS Í≤ΩÎ°ú Ï†ÄÏû•
            localStorage.setItem('lastNasPath', basePath);
            
            // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ ÌëúÏãú
            showProgressModal('üì° NAS Ï†ÑÏÜ° ÏßÑÌñâ Ï§ë...');
            closeNasModal();
            
            try {
                updateProgress(0, 1, 'Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ Ï§ë...');
                
                const response = await fetch('/api/nas-transfer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        basePath: basePath,
                        season: season,
                        sourcePath: currentGalleryPath
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showProgressComplete(data);
                } else {
                    closeProgressModal();
                    alert(`Ïò§Î•ò: ${data.message}`);
                }
            } catch (error) {
                console.error('Error transferring to NAS:', error);
                closeProgressModal();
                alert('NAS Ï†ÑÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî Í¥ÄÎ†® Ìï®ÏàòÎì§
        function openSyncModal() {
            const modal = document.getElementById('syncModal');
            modal.style.display = 'block';
            
            // ÌîÑÎ¶¨ÏÖã Î™©Î°ù Î°úÎìú
            loadPresetsForSync();
            
            // ÎßàÏßÄÎßâ ÏÇ¨Ïö© Í≤ΩÎ°ú Î∂àÎü¨Ïò§Í∏∞
            const lastSyncPath = localStorage.getItem('lastSyncPath');
            const lastSyncSeason = localStorage.getItem('lastSyncSeason');
            
            if (lastSyncPath) {
                document.getElementById('syncPath').value = lastSyncPath;
            } else if (currentGalleryPath) {
                // ÎßàÏßÄÎßâ Í≤ΩÎ°úÍ∞Ä ÏóÜÏúºÎ©¥ ÌòÑÏû¨ Í∞§Îü¨Î¶¨ Í≤ΩÎ°ú ÏÇ¨Ïö©
                document.getElementById('syncPath').value = currentGalleryPath;
            }
            
            if (lastSyncSeason) {
                document.getElementById('syncSeason').value = lastSyncSeason;
            }
        }

        function closeSyncModal() {
            document.getElementById('syncModal').style.display = 'none';
        }

        async function loadPresetsForSync() {
            try {
                const response = await fetch('/api/presets');
                const data = await response.json();
                
                const select = document.getElementById('syncPreset');
                select.innerHTML = '<option value="">ÌîÑÎ¶¨ÏÖãÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';
                
                if (data.success && data.presets.length > 0) {
                    data.presets.forEach(preset => {
                        const option = document.createElement('option');
                        option.value = preset.name;
                        option.textContent = `${preset.name} (${preset.width}x${preset.height})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading presets for sync:', error);
            }
        }

        function toggleSyncAllFields() {
            const syncAll = document.getElementById('syncAllImages').checked;
            const excelFields = document.getElementById('syncExcelFields');
            const modeText = document.getElementById('syncModeText');
            
            if (syncAll) {
                excelFields.style.display = 'none';
                modeText.textContent = '1px Ìå®ÌÑ¥ Ï†úÏô∏Ìïú Î™®Îì† Ïù¥ÎØ∏ÏßÄ (promotion, fit, illust Îì± Ï†úÏô∏)';
            } else {
                excelFields.style.display = 'block';
                modeText.textContent = 'ÏóëÏÖÄÏùò "imgs" Ïó¥ Í∏∞Ï§Ä (Ïòà: SF177E-55NXFJ ‚Üí SF177E-55N_XFJ)';
            }
        }

        async function startSync() {
            const sourcePath = document.getElementById('syncPath').value.trim();
            const season = document.getElementById('syncSeason').value.trim();
            const presetName = document.getElementById('syncPreset').value.trim();
            const syncAll = document.getElementById('syncAllImages').checked;
            const excelFile = document.getElementById('syncExcelFile').files[0];
            
            if (!sourcePath || !season || !presetName) {
                alert('Í≤ΩÎ°ú, ÏãúÏ¶å, ÌîÑÎ¶¨ÏÖãÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // Ï†ÑÏ≤¥ ÎèôÍ∏∞ÌôîÍ∞Ä ÏïÑÎãå Í≤ΩÏö∞ ÏóëÏÖÄ ÌååÏùº ÌïÑÏàò
            if (!syncAll && !excelFile) {
                alert('ÏóëÏÖÄ ÌååÏùºÏùÑ ÏÑ†ÌÉùÌïòÍ±∞ÎÇò Ï†ÑÏ≤¥ ÎèôÍ∏∞ÌôîÎ•º Ï≤¥ÌÅ¨Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
            
            // ÎßàÏßÄÎßâ ÏÇ¨Ïö© Í≤ΩÎ°ú Ï†ÄÏû•
            localStorage.setItem('lastSyncPath', sourcePath);
            localStorage.setItem('lastSyncSeason', season);
            
            // ÌîÑÎ°úÍ∑∏Î†àÏä§ Î™®Îã¨ ÌëúÏãú
            showProgressModal('üîÑ Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî ÏßÑÌñâ Ï§ë...');
            closeSyncModal();
            
            try {
                updateProgress(0, 1, syncAll ? 'Ï†ÑÏ≤¥ Ïù¥ÎØ∏ÏßÄ Í≤ÄÏÉâ Ï§ë...' : 'ÏóëÏÖÄ ÌååÏùº Î∂ÑÏÑù Ï§ë...');
                
                const formData = new FormData();
                if (excelFile) {
                    formData.append('excelFile', excelFile);
                }
                formData.append('sourcePath', sourcePath);
                formData.append('season', season);
                formData.append('presetName', presetName);
                formData.append('syncAll', syncAll);
                
                const response = await fetch('/api/sync-images', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showProgressComplete(data);
                } else {
                    closeProgressModal();
                    alert(`Ïò§Î•ò: ${data.message}`);
                }
            } catch (error) {
                console.error('Error syncing images:', error);
                closeProgressModal();
                alert('Ïù¥ÎØ∏ÏßÄ ÎèôÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
            }
        }

        // ÏÉòÌîå ÏóëÏÖÄ ÌååÏùº Îã§Ïö¥Î°úÎìú
        function downloadSampleExcel() {
            // Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ±
            const link = document.createElement('a');
            link.href = '/api/download-sample-excel';
            link.download = 'img_sample.xlsx';
            
            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î∞úÏÉù
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            console.log('üì• Sample excel file download started');
        }

        // Load presets and last path on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadPresetsFromServer(); // ÏÑúÎ≤ÑÏóêÏÑú ÌîÑÎ¶¨ÏÖã Î°úÎìú
            loadLastExternalPath(); // ÎßàÏßÄÎßâ Í≤ΩÎ°ú Î°úÎìú (ÏûêÎèô Î∏åÎùºÏö∞Ïßï Ìè¨Ìï®)
            loadPatternSettings(); // Ìå®ÌÑ¥ ÏÑ§Ï†ï Î°úÎìú
        });
    </script>
</body>
</html>
